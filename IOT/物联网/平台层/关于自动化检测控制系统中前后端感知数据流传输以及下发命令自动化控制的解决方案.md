## 场景设置
智慧农田中自动灌溉系统需要实时上报湿度给平台，平台根据湿度自动控制灌溉系统，且可以更改湿度阈值。

## 设计思路
在湿度上报时，使用异步事件消息传递的技术自动判定湿度与阈值，同时检测自动控制的缓存锁，最终判定是否需要改变灌溉系统的状态，在前端控制灌溉系统时加入缓存锁，在更改湿度阈值时删除缓存锁。同时利用`WebFlux`与前端的`fetchEventSource`进行数据流传输。

## 异步事件消息传递
### 开启异步支持
在`ProjectApplication`中加入`@EnableAsync`注解，支持异步处理。
```java
@Slf4j  
@SpringBootApplication  
@EnableAsync  
@MapperScan("com.example.project.mapper")  
public class ProjectApplication {  
  
    public static void main(String[] args) {  
       SpringApplication.run(ProjectApplication.class, args);  
  
    }  
  
}
```

### 定义事件类型
新建`event`软件包和`event`实例类
```java
@Getter  
public class DeviceEvent extends ApplicationEvent {  
    private final Integer fid; // 农田id  
    private final String valueClass; // 数值类型  
    private final String deviceClass; // 设备类型  
    private final String value; // 值  
  
  
    public DeviceEvent(Object source,Integer fid,String deviceClass,String valueClass,String value){  
        super(source);  
        this.fid = fid;  
        this.deviceClass = deviceClass;  
        this.valueClass = valueClass;  
        this.value = value;  
    }  
}
```

### 定义事件监听者